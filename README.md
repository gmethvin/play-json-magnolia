# Play JSON Magnolia typeclass derivation

This library implements typeclass derivation for Play JSON `Reads` and `Writes` using [Magnolia](https://magnolia.work/).

Right now this is just meant to be a proof of concept. It should support the typical cases for formatting case classes and sealed traits. It does not attempt to provide any configurability. The idea here is to match what Play JSON does in its default configuration.

## Performance

The examples here show that Magnolia can derive typeclass instances that perform better than those generated by the built-in Play JSON macros. With this implementation, performance is about 3-4x that of the built-in macros for a simple 6-element case class. The implementation cheats a bit by using exceptions for handling errors instead of FP patterns.

You can run some benchmarks with:

```
bench/jmh:run -i 10 -wi 5 -f1 -t1
```
That will run all benchmarks for 10 iterations, 5 warmup iterations with 1 fork and 1 thread; see the [sbt-jmh](https://github.com/ktoso/sbt-jmh) readme for more details on the options.

## Caveats

To avoid issues with conflicting implicits, you generally want to explicitly call `MagnoliaWrites.gen[Foo]` or `MagnoliaReads.gen[Foo]` to generate an instance for your type.

There is a notable special case for `Option` to match what Play JSON does. When reading a JSON object to a case class, a field may be omitted to represent a `None` value for the corresponding property, or the field may be set to `null` in the JSON. When writing a case class to a JSON object, fields with a value of `None` will be omitted entirely. This makes the implementation a bit less straightforward than it otherwise would have been.

## Contributions and future improvements

I'm sure the current implementation could be improved, so please open an issue or pull request if you have ideas!
